<!-- Search Page HTML -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Movie Search App</title>
    <style>
      /* Basic CSS for the page layout */
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        font-family: Arial, sans-serif;
      }

      h1 {
        margin-bottom: 20px;
      }

      .search-container {
        margin-bottom: 20px;
      }

      .movies-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }

      .movie-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 10px;
        width: 200px;
        cursor: pointer;
        transition: box-shadow 0.2s ease-in-out;
      }

      .movie-card:hover {
        box-shadow: 0px 0px 10px 3px rgba(0, 255, 0, 0.5);
      }

      .movie-poster {
        width: 150px;
        height: 225px;
        object-fit: cover;
        margin-bottom: 10px;
      }

      .movie-title {
        text-align: center;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Movie Search App</h1>
    <div class="search-container">
      <label for="search-input">Search for a movie:</label>
      <input id="search-input" type="text" />
      <button id="search-button">Search</button>
    </div>
    <div class="movies-container"></div>

    <!-- Add previous and next buttons to the HTML -->
    <button id="previous-button" disabled>Previous</button>
    <button id="next-button" disabled>Next</button>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
      // Add event listeners for the previous and next buttons
      const previousButton = document.getElementById("previous-button");
      const nextButton = document.getElementById("next-button");
      const searchButton = document.getElementById("search-button");
      const searchInput = document.getElementById("search-input");
      let currentPage = 1;

      previousButton.addEventListener("click", () => {
        currentPage--;
        searchMovies(searchInput.value.trim(), currentPage);
      });

      nextButton.addEventListener("click", () => {
        currentPage++;
        searchMovies(searchInput.value.trim(), currentPage);
      });

      function createMovieCard(movie) {
        const movieCard = document.createElement("div");
        movieCard.classList.add("movie-card");

        const moviePoster = document.createElement("img");
        moviePoster.classList.add("movie-poster");
        moviePoster.src = movie.poster;
        moviePoster.onerror = function () {
          movieCard.remove();
        };
        movieCard.appendChild(moviePoster);

        const movieTitle = document.createElement("div");
        movieTitle.classList.add("movie-title");
        movieTitle.textContent = movie.title;
        movieCard.appendChild(movieTitle);

        // Add click event listener to redirect to movie page
        movieCard.addEventListener("click", () => {
          window.location.href = `http://localhost:3001/movie.html?id=${movie.id}`;
        });

        return movieCard;
      }

      // Update the searchMovies function to take a page parameter
      async function searchMovies(query, page = 1) {
        try {
          const response = await axios.get(`/search/${query}/${page}`);
          console.log(response.data.results);
          let movies = response.data.results || []; // check if results exist
          const totalPages = response.data.total_pages; // handle total pages count

          previousButton.disabled = page <= 1;
          nextButton.disabled = page >= totalPages;

          const moviesContainer = document.querySelector(".movies-container");
          moviesContainer.innerHTML = "";
          if (movies.length === 0) {
            // check length of movies array
            moviesContainer.innerHTML = "<p>No results found.</p>";
          } else {
            movies.forEach((movie) => {
              const movieCard = createMovieCard(movie);
              if (movieCard) {
                moviesContainer.appendChild(movieCard);
              }
            });
          }
        } catch (error) {
          console.error(error);
        }
      }

      // Update the event listener for the search button
      const moviesContainer = document.querySelector(".movies-container");
      searchButton.addEventListener("click", () => {
        const query = searchInput.value.trim();

        if (query.length > 0) {
          currentPage = 1;
          searchMovies(query, currentPage);
        }
      });
    </script>
  </body>
</html>
