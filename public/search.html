<!-- Search Page HTML -->
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Movie Search App</title>
    <link
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <style>
      /* Basic CSS for the page layout */
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        font-family: Arial, sans-serif;
      }
      .bg-red {
        background-color: rgb(72, 29, 29);
      }

      .bg-green {
        background-color: rgb(51, 179, 51);
      }

      .bg-blue {
        background-color: rgb(98, 98, 222);
      }

      .bg-yellow {
        background-color: rgb(194, 194, 74);
      }

      .bg-purple {
        background-color: rgb(192, 52, 192);
      }

      h1 {
        margin-bottom: 20px;
      }

      .search-container {
        margin-bottom: 20px;
      }

      .movies-container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }

      .movie-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 10px;
        width: 200px;
        cursor: pointer;
        transition: box-shadow 0.2s ease-in-out;
      }

      .movie-card:hover {
        box-shadow: 0px 0px 10px 3px rgba(0, 255, 0, 0.5);
      }

      .movie-poster {
        width: 150px;
        height: 225px;
        object-fit: cover;
        margin-bottom: 10px;
      }

      .movie-title {
        text-align: center;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <!-- Navbar HTML -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">Movie Search App</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Search</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">Profile</a>
          </li>
          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              id="themesDropdown"
              role="button"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              Themes
            </a>
            <div class="dropdown-menu" aria-labelledby="themesDropdown">
              <a class="dropdown-item" href="#" onclick="setTheme('red')"
                >Red</a
              >
              <a class="dropdown-item" href="#" onclick="setTheme('green')"
                >Green</a
              >
              <a class="dropdown-item" href="#" onclick="setTheme('blue')"
                >Blue</a
              >
              <a class="dropdown-item" href="#" onclick="setTheme('yellow')"
                >Yellow</a
              >
              <a class="dropdown-item" href="#" onclick="setTheme('purple')"
                >Purple</a
              >
            </div>
          </li>
        </ul>
      </div>
    </nav>
    <h1>Movie Search App</h1>
    <div class="search-container input-group mb-3">
      <label for="search-input" class="input-group-prepend">
        <span class="input-group-text">Search for a movie:</span>
      </label>
      <input id="search-input" type="text" class="form-control" />
      <div class="input-group-append">
        <button id="search-button" class="btn btn-outline-secondary">
          Search
        </button>
      </div>
    </div>

    <div class="movies-container"></div>

    <!-- Add previous and next buttons to the HTML -->
    <button id="previous-button" class="btn btn-primary mr-2" disabled>
      Previous
    </button>
    <button id="next-button" class="btn btn-primary" disabled>Next</button>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
      // Add event listeners for the previous and next buttons
      const previousButton = document.getElementById("previous-button");
      const nextButton = document.getElementById("next-button");
      const searchButton = document.getElementById("search-button");
      const searchInput = document.getElementById("search-input");
      let currentPage = 1;

      previousButton.addEventListener("click", () => {
        currentPage--;
        searchMovies(searchInput.value.trim(), currentPage);
      });

      nextButton.addEventListener("click", () => {
        currentPage++;
        searchMovies(searchInput.value.trim(), currentPage);
      });

      function createMovieCard(movie) {
        const movieCard = document.createElement("div");
        movieCard.classList.add("movie-card");

        const moviePoster = document.createElement("img");
        moviePoster.classList.add("movie-poster");
        moviePoster.src = movie.poster;
        moviePoster.onerror = function () {
          movieCard.remove();
        };
        movieCard.appendChild(moviePoster);

        const movieTitle = document.createElement("div");
        movieTitle.classList.add("movie-title");
        movieTitle.textContent = movie.title;
        movieCard.appendChild(movieTitle);

        // Add click event listener to redirect to movie page
        movieCard.addEventListener("click", () => {
          window.location.href = `http://localhost:3001/movie.html?id=${movie.id}`;
        });

        return movieCard;
      }

      // Update the searchMovies function to take a page parameter
      async function searchMovies(query, page = 1) {
        try {
          const response = await axios.get(`/search/${query}/${page}`);
          console.log(response.data.results);
          let movies = response.data.results || []; // check if results exist
          const totalPages = response.data.total_pages; // handle total pages count

          previousButton.disabled = page <= 1;
          nextButton.disabled = page >= totalPages;

          const moviesContainer = document.querySelector(".movies-container");
          moviesContainer.innerHTML = "";
          if (movies.length === 0) {
            // check length of movies array
            moviesContainer.innerHTML = "<p>No results found.</p>";
          } else {
            movies.forEach((movie) => {
              const movieCard = createMovieCard(movie);
              if (movieCard) {
                moviesContainer.appendChild(movieCard);
              }
            });
          }
        } catch (error) {
          console.error(error);
        }
      }

      function setTheme(color) {
        axios
          .post("/theme", { color: color })
          .then((response) => {
            console.log("Theme color updated:", response.data.color);

            // Update the background color
            const body = document.querySelector("body");
            body.classList.remove(
              "bg-red",
              "bg-green",
              "bg-blue",
              "bg-yellow",
              "bg-purple"
            );
            body.classList.add(`bg-${color}`);

            // Update the movie card highlighting
            const movieCards = document.querySelectorAll(".movie-card");
            movieCards.forEach((movieCard) => {
              movieCard.style.boxShadow = `0px 0px 10px 3px rgba(${getColorCode(
                color
              )}, 0.5)`;
            });

            searchMovies(searchInput.value.trim(), currentPage);
          })
          .catch((error) => {
            console.error(error);
          });
      }

      function getColorCode(color) {
        switch (color) {
          case "red":
            return "255, 0, 0";
          case "green":
            return "0, 255, 0";
          case "blue":
            return "0, 0, 255";
          case "yellow":
            return "255, 255, 0";
          case "purple":
            return "128, 0, 128";
          default:
            return "0, 0, 0";
        }
      }

      // Update the event listener for the search button
      const moviesContainer = document.querySelector(".movies-container");
      searchButton.addEventListener("click", () => {
        const query = searchInput.value.trim();

        if (query.length > 0) {
          currentPage = 1;
          searchMovies(query, currentPage);
        }
      });

      searchInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
          event.preventDefault();
          const query = searchInput.value.trim();

          if (query.length > 0) {
            currentPage = 1;
            searchMovies(query, currentPage);
          }
        }
      });
    </script>
  </body>
</html>
